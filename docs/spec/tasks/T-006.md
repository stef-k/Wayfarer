---
id: T-006
title: Mobile SSE controller & heartbeats
status: done
labels: [api, sse]
deps: [T-001]
owner: ""
inputs:
  - design/MobileGroups.md
outputs: []
timebox: "2h"
---

## Summary
Expose `/api/mobile/sse/*` endpoints secured via API tokens and add opt-in heartbeat support so mobile clients can keep SSE connections alive without affecting existing web consumers.

## Acceptance Criteria (measurable)
- [x] `MobileSseController` streams per-user (`location-update-{username}`) and optional group (`group-location-update-{groupId}`) channels, returning 401/403 for unauthenticated/unauthorised callers.
- [x] `SseService` emits heartbeat comment frames at a configurable interval enabled only for mobile subscriptions.
- [x] Automated tests cover authorised subscription, unauthorised flows, and heartbeat emissions.

## Steps
- [x] Read inputs
- [x] Implement authenticated SSE endpoints and heartbeat scheduler
- [x] Add/adjust tests
- [x] Run verification
- [x] Update spec/index.yml (status, deps if changed)

## Verification
- `dotnet build`
- `dotnet test --filter MobileSseController`
- `dotnet test --filter SseServiceTests`

## Notes
Heartbeats default off for legacy web SSE routes; configuration handled in code using a 20s default interval.