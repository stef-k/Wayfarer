---
id: T-006
title: Mobile SSE controller & heartbeats
status: todo
labels: [api, sse]
deps: [T-001]
owner: ""
inputs:
  - design/MobileGroups.md
outputs: []
timebox: "2h"
---

## Summary
Expose `/api/mobile/sse/*` endpoints secured via API tokens and add opt-in heartbeat support so mobile clients can keep SSE connections alive without affecting existing web consumers.

## Acceptance Criteria (measurable)
- [ ] `MobileSseController` streams per-user (`location-update-{username}`) and optional group (`group-location-update-{groupId}`) channels, returning 401/403 for unauthenticated/unauthorised callers.
- [ ] `SseService` (or extension) emits heartbeat comment frames at a configurable interval enabled only for mobile subscriptions.
- [ ] Automated tests cover authorised subscription, 401 on missing token, 403 on disallowed access, and heartbeat emissions.

## Steps
- [ ] Read inputs
- [ ] Implement authenticated SSE endpoints and heartbeat scheduler
- [ ] Add/adjust tests
- [ ] Run verification
- [ ] Update spec/index.yml (status, deps if changed)

## Verification
- `dotnet test --filter MobileSse`
- `curl -i -H "Authorization: Bearer <token>" http://localhost:5000/api/mobile/sse/location-update/{username}`

## Notes
Heartbeats should default off for legacy web SSE routes; document configuration knob.