---
id: T-007
title: SSE payload enrichment & group channel
status: todo
labels: [sse, backend]
deps: [T-006]
owner: ""
inputs:
  - design/MobileGroups.md
outputs: []
timebox: "2h"
---

## Summary
Enrich location SSE broadcasts with additional metadata and introduce a group-level SSE channel so mobile clients can subscribe once per group without breaking existing web listeners.

## Acceptance Criteria (measurable)
- [ ] Location ingestion broadcasts include `{ userId, userName, locationId, timestampUtc, isLive }` while maintaining backward-compatible payload fields for web.
- [ ] Group-level channel `group-location-update-{groupId}` broadcasts for members and returns 401/403 when the caller lacks access.
- [ ] Automated tests verify enriched payload shape, continued compatibility with web SSE consumers, and group-channel delivery.

## Steps
- [ ] Read inputs
- [ ] Implement payload enrichment and group-level broadcasting
- [ ] Add/adjust tests
- [ ] Run verification
- [ ] Update spec/index.yml (status, deps if changed)

## Verification
- `dotnet test --filter LocationSseBroadcasts`
- Manual: trigger location update and confirm both per-user and group channel events

## Notes
Consider feature flag if enrichment/group channel needs staged rollout; document payload changes for clients.