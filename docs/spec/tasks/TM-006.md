---
id: TM-006
title: API - Group Locations (Latest, Query)
status: done
labels: [api, sse]
deps: [TM-002, TM-005]
inputs:
  - design/Trusted Managers Mechanism.md
outputs: []
timebox: "2h"
---

## Summary
Implement endpoints for latest locations and viewport queries scoped to group membership, reusing LocationService and applying visibility rules.

## Acceptance Criteria (measurable)
- [x] POST /api/groups/{groupId}/locations/latest returns latest per selected userIds.
- [x] POST /api/groups/{groupId}/locations/query respects bbox + zoom and returns paged results.
- [x] Authorization and visibility rules (friends/family vs org) enforced.

## Steps
- [x] Read inputs
- [x] Add controller endpoints and request models
- [x] Reuse LocationService DTOs and thresholds
- [x] Implement visibility rules per group type and settings
- [x] Update spec/index.yml

## Verification
- curl -X POST /api/groups/{groupId}/locations/latest -H "Content-Type: application/json" -d '{"includeUserIds":["..."]}'
- curl -X POST /api/groups/{groupId}/locations/query -H "Content-Type: application/json" -d '{"minLng":...,"minLat":...,"maxLng":...,"maxLat":...,"zoomLevel":12,"userIds":["..."]}'

## Notes
Keep endpoints non-public; authorize per group membership.

