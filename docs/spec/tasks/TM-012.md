---
id: TM-012
title: User UI - Groups and Map
status: todo
labels: [ui]
deps: [TM-005, TM-006, TM-007]
inputs:
  - design/Trusted Managers Mechanism.md
outputs: []
timebox: "2h"
---

## Summary
Provide User area pages for joined groups list/leave, organization peer visibility toggle, and a map view mirroring manager behavior with user-specific visibility rules. Follow the same chronological/timeline logic: a) live by threshold, b) last latest point, c) rest points in viewport. Include a sidebar to pick which of the user's groups/users to display.

## Acceptance Criteria (measurable)
- [ ] Areas/User/Views/Groups/Index.cshtml lists joined groups with leave action.
- [ ] Areas/User/Views/Groups/Map.cshtml renders picker + map; respects visibility settings.
- [ ] wwwroot/js/Areas/User/Groups/map.js integrates latest/query endpoints and SSE.
- [ ] Per-user coloring (latest + rest), hover with user context, sidebar search and "Only this" filter.
- [ ] Where users are listed or displayed, show both username and display name for clarity.
 - [ ] SSE subscribes to all selected users (Select All by default); updates map in real time.
 - [ ] Map attribution and full-width container match existing map views (BodyClass + Leaflet prefix conventions).
- [ ] Sidebar consolidates per-user controls (color chip, select checkbox, Only action, Remove where applicable).
 - [ ] Show All / Hide All apply immediately to selection and SSE.
- [ ] Chronological controls (day/month/year) available; date-filtered viewport results reflect selection.
 - [ ] Use Leaflet.markercluster for rest points; cluster icons should reflect per-user color coding (one cluster per user or multi-color where feasible).
- [ ] Include the common map utility control (zoom level, measure, copy link) consistent with other views.
 - [ ] Measure tool updates cursor to indicate active measuring (pointer/crosshair) and resets on finish/cancel.
 - [ ] Prevent removal of group owner, and for Organization groups prevent removing the last remaining manager (UI + backend guards).
 - [ ] Sidebar lists users with color chips and inline actions (Only, Remove where applicable) so all per-user controls live in one place.

## Steps
- [ ] Read inputs
- [ ] Add Razor views and JS modules
- [ ] Integrate org visibility toggle (per-user) when Type=Organisation
- [ ] Ensure map parity with manager map logic
- [ ] Update spec/index.yml

## Verification
- dotnet run â†’ /User/Groups and /User/Groups/Map
- Toggle org visibility, verify access rules change accordingly

## Notes
Friends/Family: all members visible; Organisation: gated by group flag and personal opt-out.
