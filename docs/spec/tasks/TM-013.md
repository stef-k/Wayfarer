---
id: TM-013
title: Auto-Delete Empty Groups
status: done
labels: [backend]
deps: [TM-002, TM-003]
inputs:
  - design/Trusted Managers Mechanism.md
outputs: []
timebox: "2h"
---

## Summary
Implement optional pruning of empty groups when the last member leaves, controlled via Group.IsAutoDeleteWhenEmpty or global setting.

## Acceptance Criteria (measurable)
- [x] Leaving/removal checks for last active member and deletes when enabled.
- [x] Deletion cascades/constraints are safe; audit is recorded.
- [x] Feature can be toggled off; when off, groups remain after last member leaves.

## Steps
- [x] Read inputs
- [x] Add conditional deletion in leave/remove flows
- [x] Ensure FK constraints or soft-delete patterns are respected
- [x] Add unit test(s) for both enabled/disabled modes
- [x] Update spec/index.yml

## Verification
- dotnet test --filter "FullyQualifiedName~AutoDeleteEmptyGroups"
- Manual: remove last member and confirm group deletion when enabled

## Notes
Consider background cleanup if immediate deletion is disabled (future work).
