@model Wayfarer.Models.ApplicationUser

@{
    var fullurl = $"https://{Context.Request.Host}/Public/Users/Timeline/{Model.UserName}";
    var fullurlEmbed = $"https://{Context.Request.Host}/Public/Users/Timeline/{Model.UserName}/embed";
}

<h1 class="text-center">@ViewData["Title"]</h1>

<div class="container">
    <div class="row">
        <div class="col-md-8 offset-2">
            <div class="card shadow-sm">
                <div class="card-header  text-bg-primary mb-3">
                    <h2>Timeline Settings</h2>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-4">Display Name</dt>
                        <dd class="col-sm-8">@((Model?.DisplayName) ?? "Not Set")</dd>

                        <dt class="col-sm-4">Timeline Public</dt>
                        <dd class="col-sm-8">
                            @if (Model?.IsTimelinePublic == true)
                            {
                                <span class="badge bg-success d-inline">YES</span>
                                <p>See your public timeline at <a href="@fullurl" title="Your public facing timeline!" target="_blank">@fullurl</a>
                                    <br/>You can share this link to your friends!</p>
                                <p>Or <a href="@fullurlEmbed" title="Your public facing timeline!" target="_blank">@fullurlEmbed</a>
                                    <br/>You can embed it in your blog!</p>
                            }
                            else
                            {
                                <span class="badge bg-secondary d-inline">NO</span>
                            }
                        </dd>
                        
                        <dt class="col-sm-4">Timeline Threshold</dt>
                        <dd class="col-sm-8">
                            @if (Model?.PublicTimelineTimeThreshold == null)
                            {
                                <span class="text-muted">You can set a time threshold for your public timeline.</span>
                            }
                            else
                            {
                                @if (Model?.PublicTimelineTimeThreshold == "now")
                                {
                                    <span class="badge bg-danger">Live</span>
                                    <span>Everyone will know where you are right now!</span>

                                }
                                else
                                {
                                    <span>Displaying your timeline up to @Model?.PublicTimelineTimeThreshold ago.</span>
                                }
                            }
                        </dd>
                    </dl>

                    <div class="d-grid gap-2 mt-3">
                        <a class="btn btn-outline-primary" asp-area="User" asp-controller="Timeline" asp-action="Settings">Manage Timeline Settings</a>
                    </div>

                    <div class="card-header text-bg-primary my-4">
                        <h2>Location Logging Thresholds</h2>
                    </div>

                    <p class="text-muted mb-3">
                        The server applies these thresholds to incoming location data. They help reduce
                        battery drain on mobile devices and avoid storing redundant location points.
                    </p>

                    <div class="row mb-3">
                        <div class="col-md-4 mb-3">
                            <div class="card bg-body-tertiary h-100">
                                <div class="card-body">
                                    <h6 class="card-title">
                                        <i class="bi bi-clock me-2"></i>Time Threshold
                                    </h6>
                                    <p class="display-6 mb-2 text-primary">@ViewData["LocationTimeThresholdMinutes"] min</p>
                                    <p class="small text-muted mb-0">
                                        Locations sent within <strong>@ViewData["LocationTimeThresholdMinutes"] minutes</strong>
                                        of the previous logged location are skipped.
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card bg-body-tertiary h-100">
                                <div class="card-body">
                                    <h6 class="card-title">
                                        <i class="bi bi-geo-alt me-2"></i>Distance Threshold
                                    </h6>
                                    <p class="display-6 mb-2 text-primary">@ViewData["LocationDistanceThresholdMeters"] m</p>
                                    <p class="small text-muted mb-0">
                                        Locations within <strong>@ViewData["LocationDistanceThresholdMeters"] meters</strong>
                                        of the previous logged location are skipped.
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card bg-body-tertiary h-100">
                                <div class="card-body">
                                    <h6 class="card-title">
                                        <i class="bi bi-bullseye me-2"></i>Accuracy Threshold
                                    </h6>
                                    <p class="display-6 mb-2 text-primary">@ViewData["LocationAccuracyThresholdMeters"] m</p>
                                    <p class="small text-muted mb-0">
                                        Locations with GPS accuracy worse than <strong>@ViewData["LocationAccuracyThresholdMeters"] meters</strong>
                                        are rejected.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-secondary mb-3">
                        <small>
                            <i class="bi bi-info-circle me-1"></i>
                            <strong>Note:</strong> Time and distance thresholds must be exceeded for a new location to be logged.
                            Additionally, the GPS accuracy must be within the accuracy threshold.
                            The <strong>Check-in</strong> endpoint bypasses time/distance thresholds for manual location logging.
                            These settings are configured by the server administrator.
                        </small>
                    </div>

                    <div class="card-header text-bg-primary my-4">
                        <h2>API Token Settings</h2>
                    </div>
                    
                    <div class="d-grid gap-2 mt-3">
                        <a class="btn btn-outline-primary" asp-area="User" asp-controller="ApiToken" asp-action="Index">Manage API Tokens</a>
                    </div>
                    
                    <div class="card-header  text-bg-primary my-4">
                        <h2>Locations Settings</h2>
                    </div>
                    
                    <div class="d-grid gap-2 mt-3">
                        <button class="btn btn-danger" id="deleteAllUserLocations" data-user-id="@Model?.Id">Delete All Locations</button>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @Html.FrontendViewScripts()
}
