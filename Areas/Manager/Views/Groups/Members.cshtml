@{
    var group = (Wayfarer.Models.Group)ViewBag.Group;
    var members = (IEnumerable<dynamic>)ViewBag.Members;
    var invites = (IEnumerable<Wayfarer.Models.GroupInvitation>)ViewBag.Invites;
    ViewData["Title"] = $"Members - {group.Name}";
}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>@ViewData["Title"]</h2>
  <a class="btn btn-secondary" asp-area="Manager" asp-controller="Groups" asp-action="Index">Back</a>
</div>

<div class="row">
  <div class="col-md-7">
    <h4>Roster</h4>
    <table class="table table-striped">
      <thead>
      <tr>
        <th>User</th>
        <th>Display Name</th>
        <th>Role</th>
        <th>Status</th>
        <th></th>
      </tr>
      </thead>
      <tbody>
      @foreach (var x in members)
      {
          <tr>
            <td>@x.u.UserName</td>
            <td>@x.u.DisplayName</td>
            <td>@x.m.Role</td>
            <td>@x.m.Status</td>
            <td>
              <form asp-area="Manager" asp-controller="Groups" asp-action="RemoveMember" method="post" class="d-inline">
                <input type="hidden" name="groupId" value="@group.Id" />
                <input type="hidden" name="userId" value="@x.u.Id" />
                <button type="submit" class="btn btn-sm btn-outline-danger">Remove</button>
              </form>
            </td>
          </tr>
      }
      </tbody>
    </table>
  </div>

  <div class="col-md-5">
    <h4>Invite</h4>
    <form id="inviteForm" asp-area="Manager" asp-controller="Groups" asp-action="Invite" method="post">
      <input type="hidden" name="groupId" value="@group.Id" />
      <div class="mb-2">
        <label class="form-label" for="inviteeUserId">User Id</label>
        <input class="form-control" id="inviteeUserId" name="inviteeUserId" />
      </div>
      <div class="mb-2">
        <label class="form-label" for="inviteeEmail">or Email</label>
        <input class="form-control" id="inviteeEmail" name="inviteeEmail" />
        <div class="form-text">Provide either a User Id or an Email.</div>
      </div>
      <button type="submit" class="btn btn-primary">Send Invite</button>
    </form>

    <h4 class="mt-4">Pending Invites</h4>
    <table class="table">
      <thead>
      <tr>
        <th>Invitee</th>
        <th>Created</th>
        <th></th>
      </tr>
      </thead>
      <tbody>
      @foreach (var inv in invites)
      {
          <tr>
            <td>@(inv.InviteeUserId ?? inv.InviteeEmail)</td>
            <td>@inv.CreatedAt.ToLocalTime()</td>
            <td>
              <form asp-area="Manager" asp-controller="Groups" asp-action="RevokeInvite" method="post" class="d-inline">
                <input type="hidden" name="groupId" value="@group.Id" />
                <input type="hidden" name="inviteId" value="@inv.Id" />
                <button type="submit" class="btn btn-sm btn-outline-secondary">Revoke</button>
              </form>
            </td>
          </tr>
      }
      </tbody>
    </table>
  </div>
</div>

<script src="~/js/Areas/Manager/Groups/members.js"></script>

