@{
    var groupId = (Guid)ViewBag.GroupId;
    var group = (Wayfarer.Models.Group)ViewBag.Group;
    ViewData["Title"] = $"Map - {group.Name}";
    ViewData["LoadLeaflet"] = true;
    ViewData["BodyClass"] = "container-fluid d-flex flex-column flex-fill p-0 overflow-hidden";
}

<div class="d-flex justify-content-between align-items-center mb-2">
  <h2>@ViewData["Title"]</h2>
  <a class="btn btn-secondary" asp-area="Manager" asp-controller="Groups" asp-action="Index">Back</a>
  <input type="hidden" id="groupId" value="@groupId" />
</div>

<div id="group-map-view" class="position-relative d-flex flex-grow-1 w-100 overflow-hidden">
  <aside class="flex-shrink-0 border-end overflow-auto" style="width:320px;">
    <h5>Members</h5>
    <div class="mb-2">
      <div class="btn-group w-100" role="group">
        <input type="radio" class="btn-check" name="dateType" id="dtDay" value="day" autocomplete="off">
        <label class="btn btn-outline-secondary btn-sm" for="dtDay">Day</label>
        <input type="radio" class="btn-check" name="dateType" id="dtMonth" value="month" autocomplete="off">
        <label class="btn btn-outline-secondary btn-sm" for="dtMonth">Month</label>
        <input type="radio" class="btn-check" name="dateType" id="dtYear" value="year" autocomplete="off">
        <label class="btn btn-outline-secondary btn-sm" for="dtYear">Year</label>
      </div>
      <div class="row g-1 mt-1">
        <div class="col-6">
          <input id="filterYear" type="number" class="form-control form-control-sm" placeholder="Year" />
        </div>
        <div class="col-3">
          <input id="filterMonth" type="number" class="form-control form-control-sm" placeholder="Mon" />
        </div>
        <div class="col-3">
          <input id="filterDay" type="number" class="form-control form-control-sm" placeholder="Day" />
        </div>
      </div>
      <div class="d-grid mt-1">
        <button id="applyDateFilter" class="btn btn-sm btn-outline-primary">Apply</button>
      </div>
    </div>
    @using (Html.BeginForm())
    {
        @Html.AntiForgeryToken()
    }
    <div class="mb-2">
      <input id="userSearch" type="search" class="form-control form-control-sm" placeholder="Search users..." autocomplete="off" />
    </div>
    <div id="userSidebar" class="list-group" style="max-height:70vh; overflow:auto">
      @{
          var members = (IEnumerable<dynamic>)ViewBag.Members;
      }
      <div class="list-group-item d-flex align-items-center justify-content-between">
        <label class="mb-0">
          <input type="checkbox" id="selectAllUsers" class="form-check-input me-1" checked />
          Select All
        </label>
        <div class="btn-group btn-group-sm">
          <button type="button" id="showAllUsers" class="btn btn-outline-secondary">Show All</button>
          <button type="button" id="hideAllUsers" class="btn btn-outline-secondary">Hide All</button>
        </div>
      </div>
      @foreach (var u in members)
      {
          <div class="list-group-item d-flex justify-content-between align-items-center user-item" data-filter="@u.UserName @u.DisplayName">
            <label class="mb-0 flex-grow-1">
              <span class="user-color d-inline-block me-2" style="width:12px;height:12px;border-radius:50%;vertical-align:middle;"></span>
              <input type="checkbox" class="form-check-input me-1 user-select" checked data-user-id="@u.Id" data-username="@u.UserName" data-display="@u.DisplayName" />
              @u.UserName (@u.DisplayName)
            </label>
            <div class="btn-group btn-group-sm">
              <button type="button" class="btn btn-outline-primary only-this" data-user-id="@u.Id">Only</button>
              <button type="button" class="btn btn-outline-danger remove-user" data-user-id="@u.Id">Remove</button>
            </div>
          </div>
      }
    </div>
  </aside>
  <main class="flex-grow-1 overflow-hidden">
    <div id="groupMap" class="w-100 h-100"></div>
  </main>
</div>

<script src="~/lib/leaflet/leaflet-src.js"></script>
<link rel="stylesheet" href="~/lib/leaflet/leaflet-1.9.4.css" />
<link rel="stylesheet" href="~/lib/Leaflet.markercluster-1.4.1/dist/MarkerCluster.css" />
<link rel="stylesheet" href="~/lib/Leaflet.markercluster-1.4.1/dist/MarkerCluster.Default.css" />
<script src="~/lib/Leaflet.markercluster-1.4.1/dist/leaflet.markercluster.js"></script>
<script type="module">
  import { addZoomLevelControl } from '/js/map-utils.js';
  window.__addZoomLevelControl = addZoomLevelControl;
  // If we later need the distance tool directly, we can also export it similarly.
  // import { initDistanceMeasureTool } from '/js/map-utils.js'; window.__initDistanceMeasureTool = initDistanceMeasureTool;
</script>
<script src="~/js/Areas/Manager/Groups/map.js"></script>
