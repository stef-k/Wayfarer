# Fail2ban filter for Wayfarer ASP.NET application
#
# DOCUMENTATION:
# For complete installation instructions, customization guide, and monitoring:
# See docs/developer/13-Deployment.md - Section "Security Hardening / Fail2ban"
#
# QUICK INSTALLATION:
# 1. sudo cp deployment/fail2ban-wayfarer-filter.conf /etc/fail2ban/filter.d/wayfarer.conf
# 2. Configure jail (see fail2ban-wayfarer-jail.conf and update logpath)
# 3. sudo systemctl restart fail2ban
#
# This filter detects:
# - Scanner bots looking for .php files, wp-admin, etc.
# - Repeated 404 errors
# - Failed login attempts

[Definition]

# Match 404 errors for common exploit paths (.php files, WordPress paths, etc.)
failregex = ^\[INF\] Request finished .* - 404 .* (https?://)?<HOST>.*\.(php|asp|aspx|jsp)
            ^\[INF\] Request finished .* - 404 .* (https?://)?<HOST>.*(wp-admin|wp-content|phpMyAdmin|admin\.php|shell\.php)
            ^\[INF\] Request reached the end of the middleware pipeline.*<HOST>.*\.(php|asp|aspx)
            ^\[WRN\] Failed login attempt for user .* from <HOST>
            ^\[ERR\] Suspicious request pattern detected from <HOST>

# Ignore legitimate 404s for normal resources
ignoreregex = ^\[INF\] Request finished .* - 404 .* (https?://)?<HOST>.*(\.css|\.js|\.jpg|\.png|\.gif|\.ico|robots\.txt|sitemap\.xml)

# Options
datepattern = ^%%Y-%%m-%%d %%H:%%M:%%S

[Init]
journalmatch = _SYSTEMD_UNIT=wayfarer.service
